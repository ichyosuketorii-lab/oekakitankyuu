<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ãªãŠçµµã‹ãã‚¢ãƒ—ãƒª (ç”»åƒèƒŒæ™¯ä»˜ã)</title>

    <style>
        /* CSSã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è¨˜è¿° */
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            background-color: #f4f4f4;
        }

        h1 {
            color: #333;
        }

        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* æç”»ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æ ç·šã‚’ã¤ã‘ã‚‹ */
        #drawing-board {
            border: 2px solid #333;
            /* èƒŒæ™¯ç”»åƒã®è¨­å®šã¯JavaScriptã§è¡Œã†ãŸã‚ã€ã“ã“ã§ã¯è¡Œã„ã¾ã›ã‚“ */
            background-color: #fff; /* ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
            cursor: crosshair; /* ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’åå­—ã«å¤‰æ›´ */
        }

        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <h1>ã‚·ãƒ³ãƒ—ãƒ«ãªãŠçµµã‹ã</h1>

    <div class="controls">
        <label for="color-picker">ğŸ–Šï¸ **è‰²**:</label>
        <input type="color" id="color-picker" value="#000000">

        <label for="line-width">ğŸ“ **å¤ªã•**:</label>
        <input type="range" id="line-width" min="1" max="50" value="5">

        <button id="clear-button">ğŸ—‘ï¸ **å…¨æ¶ˆå»**</button>
        <button id="reset-image-button">ğŸ–¼ï¸ **èƒŒæ™¯ã‚’å†èª­ã¿è¾¼ã¿**</button>
    </div>

    <canvas id="drawing-board" width="800" height="600"></canvas>

    <script>
        // JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è¨˜è¿°
        document.addEventListener('DOMContentLoaded', () => {
            // è¦ç´ ã®å–å¾—
            const canvas = document.getElementById('drawing-board');
            const ctx = canvas.getContext('2d');
            const colorPicker = document.getElementById('color-picker');
            const clearButton = document.getElementById('clear-button');
            const lineWidthInput = document.getElementById('line-width');
            const resetImageButton = document.getElementById('reset-image-button'); // è¿½åŠ 

            // æç”»çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let backgroundImage = new Image(); // èƒŒæ™¯ç”»åƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

            // åˆæœŸæç”»è¨­å®š
            ctx.lineWidth = lineWidthInput.value;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.strokeStyle = colorPicker.value;

            // --- èƒŒæ™¯ç”»åƒã®èª­ã¿è¾¼ã¿ã¨æç”» ---
            const loadImageBackground = () => {
                backgroundImage.src = 'image1.jpg'; // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ã“ã¨ã‚’æƒ³å®š
                backgroundImage.onload = () => {
                    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’ç”»åƒã«åˆã‚ã›ã‚‹ã‹ã€ç”»åƒã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹ã‹é¸æŠ
                    // ã“ã“ã§ã¯ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ç”»åƒã‚’æ‹¡å¤§ç¸®å°ã—ã¦æç”»ã—ã¾ã™
                    
                    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä¸€åº¦ã‚¯ãƒªã‚¢
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // ç”»åƒã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹å…¨ä½“ã«æç”» (ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒã—ã¤ã¤ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹)
                    const hRatio = canvas.width / backgroundImage.width;
                    const vRatio = canvas.height / backgroundImage.height;
                    const ratio = Math.min(hRatio, vRatio); // å°ã•ã„æ–¹ã®æ¯”ç‡ã«åˆã‚ã›ã¦ç¸®å°

                    const centerShiftX = (canvas.width - backgroundImage.width * ratio) / 2;
                    const centerShiftY = (canvas.height - backgroundImage.height * ratio) / 2;

                    ctx.drawImage(backgroundImage, 0, 0, backgroundImage.width, backgroundImage.height,
                                    centerShiftX, centerShiftY, backgroundImage.width * ratio, backgroundImage.height * ratio);
                    
                    // ã¾ãŸã¯ã€ç”»åƒã‚’ãã®ã¾ã¾ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å·¦ä¸Šã«æç”»ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’è§£é™¤
                    // ctx.drawImage(backgroundImage, 0, 0);

                    // ã¾ãŸã¯ã€ç”»åƒã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹å…¨ä½“ã«å¼•ãä¼¸ã°ã—ã¦æç”»ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’è§£é™¤
                    // ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

                };
                backgroundImage.onerror = () => {
                    console.error('èƒŒæ™¯ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ã€ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    // ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã‹ã£ãŸå ´åˆã€èƒŒæ™¯ã‚’ç™½ã«æˆ»ã™ãªã©
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                };
            };

            // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«èƒŒæ™¯ç”»åƒã‚’èª­ã¿è¾¼ã‚€
            loadImageBackground();

            // --- æç”»é–¢æ•° ---
            function draw(e) {
                if (!isDrawing) return;

                // æç”»è¨­å®šã®æ›´æ–°
                ctx.strokeStyle = colorPicker.value;
                ctx.lineWidth = lineWidthInput.value;

                // æç”»
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();

                // æ¬¡ã®æç”»ã®ãŸã‚ã«ç¾åœ¨ã®åº§æ¨™ã‚’è¨˜éŒ²
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }

            // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---

            // 1. æç”»é–‹å§‹
            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });

            // 2. æç”»å®Ÿè¡Œ
            canvas.addEventListener('mousemove', draw);

            // 3. æç”»çµ‚äº†
            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseout', () => isDrawing = false);

            // 4. å…¨æ¶ˆå»ãƒœã‚¿ãƒ³
            clearButton.addEventListener('click', () => {
                // èƒŒæ™¯ç”»åƒã‚’å†æç”»ã—ã¦ã‹ã‚‰ã‚¯ãƒªã‚¢
                loadImageBackground(); // èƒŒæ™¯ã‚’å†æç”»
                // ctx.clearRect(0, 0, canvas.width, canvas.height); // ã“ã‚Œã ã¨èƒŒæ™¯ã‚‚æ¶ˆãˆã‚‹
            });

            // 5. ç·šã®å¤ªã•å¤‰æ›´
            lineWidthInput.addEventListener('input', (e) => {
                ctx.lineWidth = e.target.value;
            });

            // 6. èƒŒæ™¯ã‚’å†èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ (è¿½åŠ )
            resetImageButton.addEventListener('click', () => {
                loadImageBackground();
            });

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®ã‚µãƒãƒ¼ãƒˆ (ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                isDrawing = true;
                [lastX, lastY] = [x, y];
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing) return;

                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                draw({ offsetX: x, offsetY: y });
            });

            canvas.addEventListener('touchend', () => isDrawing = false);
        });
    </script>
</body>
</html>
